[{"F:\\Frontend\\news-explorer\\frontend\\src\\index.js":"1","F:\\Frontend\\news-explorer\\frontend\\src\\components\\App.js":"2","F:\\Frontend\\news-explorer\\frontend\\src\\components\\SavedNews.js":"3","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Main.js":"4","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Footer.js":"5","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Header.js":"6","F:\\Frontend\\news-explorer\\frontend\\src\\components\\About.js":"7","F:\\Frontend\\news-explorer\\frontend\\src\\components\\SearchForm.js":"8","F:\\Frontend\\news-explorer\\frontend\\src\\components\\NewsCardList.js":"9","F:\\Frontend\\news-explorer\\frontend\\src\\components\\NewsCard.js":"10","F:\\Frontend\\news-explorer\\frontend\\src\\components\\SavedNewsHeader.js":"11","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Navigation.js":"12","F:\\Frontend\\news-explorer\\frontend\\src\\components\\LoginPopup.js":"13","F:\\Frontend\\news-explorer\\frontend\\src\\utils\\NewsApi.js":"14","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Preloader.js":"15","F:\\Frontend\\news-explorer\\frontend\\src\\contexts\\CurrentUserContext.js":"16","F:\\Frontend\\news-explorer\\frontend\\src\\components\\ProtectedRoute.js":"17","F:\\Frontend\\news-explorer\\frontend\\src\\components\\Popup.js":"18","F:\\Frontend\\news-explorer\\frontend\\src\\components\\RegisterPopup.js":"19","F:\\Frontend\\news-explorer\\frontend\\src\\components\\RegisterInfoPopup.js":"20","F:\\Frontend\\news-explorer\\frontend\\src\\utils\\MainApi.js":"21"},{"size":335,"mtime":1613216844753,"results":"22","hashOfConfig":"23"},{"size":8310,"mtime":1614209049297,"results":"24","hashOfConfig":"23"},{"size":1292,"mtime":1614113562914,"results":"25","hashOfConfig":"23"},{"size":1697,"mtime":1614208264503,"results":"26","hashOfConfig":"23"},{"size":1106,"mtime":1613216843819,"results":"27","hashOfConfig":"23"},{"size":2256,"mtime":1614094106091,"results":"28","hashOfConfig":"23"},{"size":1022,"mtime":1613216843757,"results":"29","hashOfConfig":"23"},{"size":1328,"mtime":1613242730551,"results":"30","hashOfConfig":"23"},{"size":2536,"mtime":1614208206553,"results":"31","hashOfConfig":"23"},{"size":2813,"mtime":1614208166288,"results":"32","hashOfConfig":"23"},{"size":1624,"mtime":1613955715035,"results":"33","hashOfConfig":"23"},{"size":2271,"mtime":1614098487301,"results":"34","hashOfConfig":"23"},{"size":2831,"mtime":1614197613905,"results":"35","hashOfConfig":"23"},{"size":1960,"mtime":1614288672264,"results":"36","hashOfConfig":"23"},{"size":230,"mtime":1613260187609,"results":"37","hashOfConfig":"23"},{"size":117,"mtime":1613851409535,"results":"38","hashOfConfig":"23"},{"size":289,"mtime":1613851409534,"results":"39","hashOfConfig":"23"},{"size":1160,"mtime":1614106392539,"results":"40","hashOfConfig":"23"},{"size":3391,"mtime":1614197523351,"results":"41","hashOfConfig":"23"},{"size":527,"mtime":1614106162804,"results":"42","hashOfConfig":"23"},{"size":2480,"mtime":1614288672264,"results":"43","hashOfConfig":"23"},{"filePath":"44","messages":"45","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},"18kl9o",{"filePath":"47","messages":"48","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"49","usedDeprecatedRules":"46"},{"filePath":"50","messages":"51","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"52","messages":"53","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"54","messages":"55","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"56","messages":"57","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"58","messages":"59","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"60","messages":"61","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"62","messages":"63","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"64","messages":"65","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"66","messages":"67","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"68","messages":"69","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"70","messages":"71","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"72","messages":"73","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"74","messages":"75","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"76"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"81","messages":"82","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"83","messages":"84","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"85","messages":"86","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"46"},{"filePath":"87","messages":"88","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"89","usedDeprecatedRules":"46"},"F:\\Frontend\\news-explorer\\frontend\\src\\index.js",[],["90","91"],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\App.js",["92"],"import React from \"react\";\r\nimport { Route, Switch, useHistory } from 'react-router-dom';\r\nimport './App.css';\r\nimport LoginPopup from \"./LoginPopup\";\r\nimport Main from './Main.js';\r\nimport ProtectedRoute from './ProtectedRoute.js';\r\nimport RegisterPopup from './RegisterPopup.js';\r\nimport RegisterInfoPopup from './RegisterInfoPopup.js';\r\nimport SavedNews from './SavedNews.js';\r\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\r\nimport { mainApi } from '../utils/MainApi.js' \r\nimport { newsApi } from '../utils/NewsApi.js' \r\n\r\nfunction App() {\r\n  const expandSize = 3;\r\n\r\n  const tokenStorageKey = 'news-token';\r\n  const newsStorageKey = 'last-news';\r\n\r\n  const [currentUser, setCurrentUser] = React.useState({});\r\n\r\n  const [news, setNews] = React.useState([]);\r\n  const [savedNews, setSavedNews] = React.useState([]);\r\n\r\n  const [showNews, setShowNews] = React.useState(false);\r\n  const [showedCount, setShowedCount] = React.useState(expandSize);\r\n\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [loadingError, setLoadingError] = React.useState(null);\r\n\r\n  const [loginOpened, setLoginOpened] = React.useState(false);\r\n  const [loginError, setLoginError] = React.useState();\r\n\r\n  const [registerOpened, setRegisterOpened] = React.useState(false);\r\n  const [registerError, setRegisterError] = React.useState();\r\n  const [registerInfoOpened, setRegisterInfoOpened] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    async function initAsync() {\r\n      await authorizeOnStartupAsync();\r\n      await restoreNewsFromStorage();\r\n    };\r\n    initAsync();\r\n\r\n    return () => {};\r\n  }, []);\r\n\r\n  const history = useHistory();\r\n\r\n  async function authorizeOnStartupAsync() {\r\n    try {\r\n      const token = localStorage.getItem(tokenStorageKey);\r\n      if (!token) {\r\n        return;\r\n      }\r\n\r\n      const userData = await mainApi.getUserAsync(token);\r\n      setCurrentUser({ ...userData.data, isAuthorized: true });\r\n\r\n      await loadSavedNewsAsync();\r\n    } catch (err) {\r\n      console.log('Ошибка при аутентификации: ', err);\r\n    }\r\n  }\r\n\r\n  function restoreNewsFromStorage() {\r\n    try {\r\n      const storedNewsJson = localStorage.getItem(newsStorageKey);\r\n      if (!storedNewsJson) {\r\n        return;\r\n      }\r\n\r\n      const storedNews = JSON.parse(storedNewsJson);\r\n      if (storedNews.length > 0) {\r\n        setShowNews(true);\r\n        setNews(storedNews);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  async function loadSavedNewsAsync() {\r\n    try {\r\n      const token = localStorage.getItem(tokenStorageKey);\r\n      const newsData = await mainApi.getSavedNewsAsync(token);\r\n      setSavedNews(newsData.data);\r\n    } catch (err) {\r\n      console.log('Ошибка при загрузке сохраненных новостей:', err);\r\n    }\r\n  }\r\n\r\n  async function handleQueryAsync(query) {\r\n    setShowNews(true);\r\n    setIsLoading(true);\r\n    try {\r\n      const now = new Date();\r\n      const lastWeek = new Date();\r\n      lastWeek.setDate(now.getDate() - 7);\r\n      \r\n      const data = await newsApi.getEverythingAsync({\r\n        q: query,\r\n        from: lastWeek,\r\n        to: now,\r\n        pageSize: 100,\r\n      });\r\n\r\n      localStorage.setItem(newsStorageKey, JSON.stringify(data));\r\n      setNews(data);\r\n      setShowedCount(expandSize);\r\n      setLoadingError(null);\r\n    } catch (err) {\r\n      console.log('Ошибка при поиске новостей:', err);\r\n      setLoadingError(err.message);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleLoginAsync({ email, password }) {\r\n    try {\r\n      const tokenData = await mainApi.signInAsync({ email, password });\r\n      const token = tokenData.token;\r\n      localStorage.setItem(tokenStorageKey, token);\r\n\r\n      const userData = await mainApi.getUserAsync(token);\r\n      setCurrentUser({ ...userData.data, isAuthorized: true });\r\n      setLoginOpened(false);\r\n    } catch (err) {\r\n      console.log('Ошибка при аутентификации:', err);\r\n      setLoginError(err.message);\r\n    }\r\n  }\r\n\r\n  function handleLogout() {\r\n    if (currentUser.isAuthorized) {\r\n      const actualNews = news.map(item => {\r\n        return { ...item, _id: undefined }\r\n      });\r\n\r\n      setCurrentUser({});\r\n      setNews(actualNews);\r\n\r\n      localStorage.removeItem(tokenStorageKey);\r\n      localStorage.setItem(newsStorageKey, JSON.stringify(actualNews));\r\n\r\n      history.push('/');\r\n    }\r\n  }\r\n\r\n  async function handleRegisterAsync({ email, password, name }) {\r\n    try {\r\n      await mainApi.signUpAsync({ email, password, name });\r\n      showRegisterInfo();\r\n    } catch(err) {\r\n      console.log('Ошибка при регистрации:', err);\r\n      setRegisterError(err.message);\r\n    }\r\n  }\r\n\r\n  async function handleCardSaveAsync(card) {\r\n    try {\r\n      const token = localStorage.getItem(tokenStorageKey);\r\n      const saveResult = await mainApi.saveNewsAsync(card, token);\r\n      \r\n      const savedCard = { ...saveResult.data, owner: undefined, __v: undefined };\r\n      const actualNews = news.map(old => (old === card) ? savedCard : old);\r\n      const actualSavedNews = [savedCard].concat(savedNews);\r\n\r\n      localStorage.setItem(newsStorageKey, JSON.stringify(actualNews));\r\n      setNews(actualNews);\r\n      setSavedNews(actualSavedNews);\r\n    } catch(err) {\r\n      console.log('Ошибка при сохранении карточки:', err);\r\n    }\r\n  }\r\n\r\n  async function handleCardRemoveAsync(card) {\r\n    try {\r\n      const token = localStorage.getItem(tokenStorageKey);\r\n      await mainApi.removeNewsAsync(card._id, token);\r\n\r\n      const actualNews = news.map(old => (old === card) ? { ...old, _id: undefined } : old);\r\n      const actualSavedNews = savedNews.filter(old => old._id !== card._id);\r\n\r\n      localStorage.setItem(newsStorageKey, JSON.stringify(actualNews));\r\n      setNews(actualNews);\r\n      setSavedNews(actualSavedNews);\r\n    } catch(err) {\r\n      console.log('Ошибка при удалении карточки:', err);\r\n    }\r\n  }\r\n\r\n  function showLogin() {\r\n    closeAllPopups();\r\n    setLoginError('');\r\n    setLoginOpened(true);\r\n  };\r\n\r\n  function showRegister() {\r\n    closeAllPopups();\r\n    setRegisterError('');\r\n    setRegisterOpened(true);\r\n  }\r\n\r\n  function showRegisterInfo() {\r\n    closeAllPopups();\r\n    setRegisterInfoOpened(true);\r\n  }\r\n\r\n  function closeAllPopups() {\r\n    setLoginOpened(false);\r\n    setRegisterOpened(false);\r\n    setRegisterInfoOpened(false);\r\n  }\r\n\r\n  function handleShowMoreNews() {\r\n    setShowedCount(showedCount + expandSize);\r\n  }\r\n\r\n  return (\r\n    <CurrentUserContext.Provider value={currentUser}>\r\n      <div className=\"App\">\r\n        <Switch>\r\n          <ProtectedRoute path=\"/saved-news\" redirect=\"/\" canAccess={currentUser}>\r\n            <SavedNews\r\n              news={savedNews}\r\n              onLogin={showLogin}\r\n              onLogout={handleLogout}\r\n              onCardRemove={handleCardRemoveAsync}\r\n            />\r\n          </ProtectedRoute>\r\n          <Route path=\"/\">\r\n            <Main\r\n              news={news}\r\n              showedNewsCount={showedCount}\r\n              showNews={showNews}\r\n              isLoading={isLoading}\r\n              loadingError={loadingError}\r\n              onQuery={handleQueryAsync}\r\n              onLogin={showLogin}\r\n              onLogout={handleLogout}\r\n              onCardSave={handleCardSaveAsync}\r\n              onCardRemove={handleCardRemoveAsync}\r\n              onShowMoreNews={handleShowMoreNews}\r\n            />\r\n          </Route>\r\n        </Switch>\r\n        <LoginPopup\r\n          isOpened={loginOpened}\r\n          error={loginError}\r\n          onLogin={handleLoginAsync}\r\n          onRegisterRedirect={showRegister}\r\n          onClose={closeAllPopups}\r\n        />\r\n        <RegisterPopup\r\n          isOpened={registerOpened}\r\n          error={registerError}\r\n          onRegister={handleRegisterAsync}\r\n          onLoginRedirect={showLogin}\r\n          onClose={closeAllPopups}\r\n        />\r\n        <RegisterInfoPopup\r\n          isOpened={registerInfoOpened}\r\n          onLoginRedirect={showLogin}\r\n          onClose={closeAllPopups}\r\n        />\r\n      </div>\r\n    </CurrentUserContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","F:\\Frontend\\news-explorer\\frontend\\src\\components\\SavedNews.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Main.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Footer.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Header.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\About.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\SearchForm.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\NewsCardList.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\NewsCard.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\SavedNewsHeader.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Navigation.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\LoginPopup.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\utils\\NewsApi.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Preloader.js",[],["93","94"],"F:\\Frontend\\news-explorer\\frontend\\src\\contexts\\CurrentUserContext.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\ProtectedRoute.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\Popup.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\RegisterPopup.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\components\\RegisterInfoPopup.js",[],"F:\\Frontend\\news-explorer\\frontend\\src\\utils\\MainApi.js",["95","96"],"export const mainApiUrl = 'https://api.nexplorer.students.nomoreparties.space';\r\n\r\nexport class MainApi {\r\n  constructor(options) {\r\n    this._baseUrl = options.baseUrl;\r\n  }\r\n\r\n  async signInAsync(data) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/signin',\r\n      this._getRequestOptions('POST', data));\r\n\r\n    if (response.status == 401) {\r\n      throw new Error('Некорректные имя пользователя или пароль');\r\n    }\r\n\r\n    return await this._readResponseContentAsync(response);\r\n  }\r\n\r\n  async signUpAsync(data) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/signup',\r\n      this._getRequestOptions('POST', data));\r\n\r\n    if (response.status == 409) {\r\n      throw new Error('Такой пользователь уже есть');\r\n    }\r\n\r\n    return await this._readResponseContentAsync(response);\r\n  }\r\n\r\n  async getUserAsync(token) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/users/me',\r\n      this._getRequestOptions('GET', null, token));\r\n\r\n    return await this._readResponseContentAsync(response);\r\n  }\r\n\r\n  async getSavedNewsAsync(token) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/articles',\r\n      this._getRequestOptions('GET', null, token));\r\n      \r\n    return await this._readResponseContentAsync(response);\r\n  }\r\n\r\n  async saveNewsAsync(data, token) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/articles',\r\n      this._getRequestOptions('POST', data, token));\r\n\r\n    return await this._readResponseContentAsync(response);\r\n  }\r\n\r\n  async removeNewsAsync(id, token) {\r\n    const response = await fetch(\r\n      this._baseUrl + '/articles/' + id,\r\n      this._getRequestOptions('DELETE', null, token));\r\n\r\n    if (!response.ok) {\r\n      throw new Error(response.statusText);\r\n    }\r\n  }\r\n\r\n  _getRequestOptions(method, data, token) {\r\n    const options = { headers: {} };\r\n\r\n    if (method) {\r\n      options.method = method;\r\n    }\r\n\r\n    if (data) {\r\n      options.headers['Content-Type'] = 'application/json';\r\n      options.body = JSON.stringify(data);\r\n    }\r\n\r\n    if (token) {\r\n      options.headers['Authorization'] = `Bearer ${token}`;\r\n    }\r\n\r\n    return options;\r\n  }\r\n\r\n  async _readResponseContentAsync(response) {\r\n    console.log(response);\r\n    if (!response.ok) {\r\n      throw new Error(response.statusText);\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n}\r\n\r\nexport const mainApi = new MainApi({\r\n  baseUrl: mainApiUrl,\r\n})",{"ruleId":"97","replacedBy":"98"},{"ruleId":"99","replacedBy":"100"},{"ruleId":"101","severity":1,"message":"102","line":46,"column":6,"nodeType":"103","endLine":46,"endColumn":8,"suggestions":"104"},{"ruleId":"97","replacedBy":"105"},{"ruleId":"99","replacedBy":"106"},{"ruleId":"107","severity":1,"message":"108","line":13,"column":25,"nodeType":"109","messageId":"110","endLine":13,"endColumn":27},{"ruleId":"107","severity":1,"message":"108","line":25,"column":25,"nodeType":"109","messageId":"110","endLine":25,"endColumn":27},"no-native-reassign",["111"],"no-negated-in-lhs",["112"],"react-hooks/exhaustive-deps","React Hook React.useEffect has a missing dependency: 'authorizeOnStartupAsync'. Either include it or remove the dependency array.","ArrayExpression",["113"],["111"],["112"],"eqeqeq","Expected '===' and instead saw '=='.","BinaryExpression","unexpected","no-global-assign","no-unsafe-negation",{"desc":"114","fix":"115"},"Update the dependencies array to be: [authorizeOnStartupAsync]",{"range":"116","text":"117"},[1631,1633],"[authorizeOnStartupAsync]"]